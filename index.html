<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width,initial-scale=1" name="viewport"/>
    <title>Teacher Toybox: Free Interactive Digital Whiteboard for Teachers</title>
    
    <script>
        // The screen width of the largest iPad Pro (12.9-inch) in portrait mode is 1024px.
        const LARGE_TABLET_BREAKPOINT = 1024;

        // Check if the current window's width is less than or equal to the breakpoint.
        if (window.innerWidth <= LARGE_TABLET_BREAKPOINT) {
            // If it's a tablet or mobile device, redirect to mobile.html.
            window.location.href = 'mobile.html';
        }
    </script>
    
    <meta content="Engage your classroom with Teacher Toybox, a free interactive digital whiteboard with built-in tools like timers, dice, a drawing canvas, and multimedia support. No installation required." name="description"/>
    <meta content="Teacher Toybox: Free Interactive Digital Whiteboard" property="og:title"/>
    <meta content="Engage your classroom with Teacher Toybox, a free interactive digital whiteboard with built-in tools like timers, dice, a drawing canvas, and multimedia support. No installation required." property="og:description"/>
    <meta content="website" property="og:type"/>
    <meta content="https://www.teachertoybox.com/" property="og:url"/>
    <meta content="https://www.teachertoybox.com/party.png" property="og:image"/>
    <meta content="summary_large_image" name="twitter:card"/>
    <meta content="Teacher Toybox: Free Interactive Digital Whiteboard" name="twitter:title"/>
    <meta content="Engage your classroom with Teacher Toybox, a free interactive digital whiteboard with built-in tools like timers, dice, a drawing canvas, and multimedia support. No installation required." name="twitter:description"/>
    <meta content="https://www.teachertoybox.com/party.png" name="twitter:image"/>
    <script id="schema-ld" type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "Teacher Toybox",
        "operatingSystem": "Web",
        "applicationCategory": "EducationApplication",
        "description": "Teacher Toybox is a free interactive digital whiteboard and collection of tools for teachers. Create dynamic lessons with a drawing canvas, timers, dice rollers, and more. No installation required.",
        "keywords": "digital whiteboard, interactive whiteboard, teacher tools, classroom resources, free teacher tools, online timer, classroom activities, education",
        "url": "https://www.teachertoybox.com/",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "4.9",
          "reviewCount": "188"
        }
      }
      </script>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>

    <link rel="alternate" hreflang="en" href="https://www.teachertoybox.com/desktop.html" />
    <link rel="alternate" hreflang="cs" href="https://www.teachertoybox.com/desktop.html?lang=cs" />
    <link rel="alternate" hreflang="zh" href="https://www.teachertoybox.com/desktop.html?lang=zh" />
    <link rel="alternate" hreflang="hi" href="https://www.teachertoybox.com/desktop.html?lang=hi" />
    <link rel="alternate" hreflang="es" href="https://www.teachertoybox.com/desktop.html?lang=es" />
    <link rel="alternate" hreflang="fr" href="https://www.teachertoybox.com/desktop.html?lang=fr" />
    <link rel="alternate" hreflang="ar" href="https://www.teachertoybox.com/desktop.html?lang=ar" />
    <link rel="alternate" hreflang="pt" href="https://www.teachertoybox.com/desktop.html?lang=pt" />
    <link rel="alternate" hreflang="ru" href="https://www.teachertoybox.com/desktop.html?lang=ru" />
    <link rel="alternate" hreflang="uk" href="https://www.teachertoybox.com/desktop.html?lang=uk" />
    <link rel="alternate" hreflang="fa" href="https://www.teachertoybox.com/desktop.html?lang=fa" />
    <link rel="alternate" hreflang="x-default" href="https://www.teachertoybox.com/desktop.html" />

    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-G0954N12KN"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-G0954N12KN');
      </script>
    <link as="image" href="ttlogo.png" rel="preload" type="image/png"/>
    <link href="style.css" rel="stylesheet"/>
    <link href="tour.css" rel="stylesheet"/>
    <link href="numbered-list.css" rel="stylesheet"/>
    <link href="info-window.css" rel="stylesheet"/>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://cdn.auth0.com/js/auth0-spa-js/2.1/auth0-spa-js.production.js"></script>
    <style>
        /* Splash screen overlay */
        #splash-screen {
          position: fixed;
          top: 0; left: 0;
          width: 100vw; height: 100vh;
          background-color: var(--bg-color);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 99999;
          transition: opacity 0.5s ease;
        }
        #splash-screen img { height: 110px; width: auto; }

        /* Language picker styles restored */
        #lang-picker-wrap {
          margin: 6px 0 0;
          display: flex;
          justify-content: flex-end;
          padding-right: 10px;
          gap: 8px;
          align-items: center;
        }
        #langSelect {
          background: var(--bar-bg, #2c2c2e);
          color: var(--text-primary, #f2f2f7);
          border: 1px solid var(--border-color, rgba(88,88,91,.5));
          border-radius: 6px;
          padding: 4px 8px;
          font: inherit;
        }
        .visually-hidden {
          position: absolute !important;
          height: 1px; width: 1px;
          overflow: hidden; clip: rect(1px,1px,1px,1px);
          white-space: nowrap;
        }
      </style>
    <script src="numbered-list.js" defer></script>
    <script src="info-text.js" defer></script>
    <script src="auth.js"></script>
    <script src="script.js" defer></script>
    <script src="tour.js" defer></script>
</head>
<body>
    <div id="splash-screen">
        <img alt="Teacher Toybox Logo" src="ttlogo.png"/>
    </div>
    <div id="site-title">
        <div class="title-line">
            <img alt="Teacher Toybox Logo" id="site-logo-desktop" src="ttlogo.png"/>
            <h1><span data-i18n="site.brand">Teacher Toybox</span></h1>
        </div>
        <p data-i18n="site.subtitle" id="site-subtitle">A whiteboard built by teachers for teachers.</p>
        <div id="lang-picker-wrap">
            <label class="visually-hidden" data-i18n="lang.label" for="langSelect">Language</label>
            <select aria-label="Language" id="langSelect"></select>
        </div>
    </div>
    <div id="sidebar">
        <div id="sidebar-main-controls">
            <div id="upgrade-tools-container">
                <button class="btn premium-login-style" data-i18n-title="btn.upgrade" id="upgradeButton" title="Upgrade to Premium (U)">
                    <i class="fas fa-crown"></i>
                </button>
            </div>
            
            <div id="userProfile" class="btn" style="display: none;"></div>
            <button class="btn" id="authButton"></button>

            <button class="btn" data-i18n-title="btn.add" id="addButton" title="Add New Window (N)">
                <i class="fas fa-plus"></i><span class="hotkey-label">N</span>
            </button>
            <div id="layout-tools-container">
                <button class="btn" data-i18n-title="btn.layouts" id="screenButton" title="Toggle Layouts (L)">
                    <i class="fas fa-desktop"></i><span class="hotkey-label">L</span>
                </button>
                <div id="layout-bar">
                    <button class="btn" data-i18n-title="layout.1" id="layout1Button" title="Layout 1: Full Screen (1)">1<span class="hotkey-label">1</span></button>
                    <button class="btn" data-i18n-title="layout.2" id="layout2Button" title="Layout 2: Split Vertical (2)">2<span class="hotkey-label">2</span></button>
                    <button class="btn" data-i18n-title="layout.3" id="layout3Button" title="Layout 3: Main Left (3)">3<span class="hotkey-label">3</span></button>
                    <button class="btn" data-i18n-title="layout.4" id="layout4Button" title="Layout 4: Main Right (4)">4<span class="hotkey-label">4</span></button>
                    <button class="btn" data-i18n-title="layout.5" id="layout5Button" title="Layout 5: Four Quadrants (5)">5<span class="hotkey-label">5</span></button>
                    <button class="btn" data-i18n-title="layout.6" id="layout6Button" title="Layout 6: Tall Right Column (6)">6<span class="hotkey-label">6</span></button>
                    <button class="btn" data-i18n-title="layout.7" id="layout7Button" title="Layout 7: 1-2-2 Column (7)">7<span class="hotkey-label">7</span></button>
                </div>
            </div>
            <button class="btn" data-i18n-title="btn.refresh" id="refreshButton" title="Refresh Page (R)"><i class="fas fa-sync-alt"></i><span class="hotkey-label">R</span></button>

            <div id="management-tools-container">
                <button class="btn" data-i18n-title="btn.management" id="managementButton" title="Classroom Management Tools (/)">
                    <i class="fas fa-chalkboard-teacher"></i><span class="hotkey-label">/</span>
                </button>
                <div id="management-bar">
                    <button class="btn" data-i18n-title="btn.bell" id="bellButton" title="Ring Bell (B)">
                        <i class="fas fa-bell"></i><span class="hotkey-label">B</span>
                    </button>
                    <button class="btn" data-i18n-title="btn.shh" id="shhButton" title="Shush Sound (S)">
                        Shh<span class="hotkey-label">S</span>
                    </button>
                    <button class="btn" data-i18n-title="btn.laser" id="laserButton" title="Toggle Laser Pointer (P)">
                        <i class="fas fa-crosshairs"></i><span class="hotkey-label">P</span>
                    </button>
                </div>
            </div>
            <div id="extra-tools-container">
                <button class="btn" data-i18n-title="btn.colour" id="extraToolsButton" title="Website Colour (X)">
                    <i class="fas fa-paint-roller"></i><span class="hotkey-label">X</span>
                </button>
                <div id="extra-tools-bar">
                    <button class="btn" data-i18n-title="btn.color" id="colorButton" title="Select Accent Color (C)">
                        <i class="fas fa-palette"></i><span class="hotkey-label">C</span>
                    </button>
                    <button class="btn" data-i18n-title="btn.magic" id="magicColorButton" title="Extract Color from Content (M)">
                        <i class="fas fa-magic"></i><span class="hotkey-label">M</span>
                    </button>
                    <button class="btn" data-i18n-title="btn.themePalette" id="themePaletteButton" title="Theme Palette (Z)">
                        <i class="fas fa-swatchbook"></i><span class="hotkey-label">Z</span>
                    </button>
                </div>
                <div id="color-palette" class="hidden">
                    <div class="palette-swatch" data-color="#3862C4" style="background-color: #3862C4;" title="Default Blue"></div>
                    <div class="palette-swatch" data-color="#E87A00" style="background-color: #E87A00;" title="Sunset Orange"></div>
                    <div class="palette-swatch" data-color="#D92A2A" style="background-color: #D92A2A;" title="Crimson Red"></div>
                    <div class="palette-swatch" data-color="#008A4B" style="background-color: #008A4B;" title="Forest Green"></div>
                    <div class="palette-swatch" data-color="#8E44AD" style="background-color: #8E44AD;" title="Amethyst Purple"></div>
                    <div class="palette-swatch" data-color="#16A085" style="background-color: #16A085;" title="Sea Green"></div>
                    <div class="palette-swatch" data-color="#E91E63" style="background-color: #E91E63;" title="Magenta"></div>
                    <div class="palette-swatch" data-color="#555555" style="background-color: #555555;" title="Graphite"></div>
                </div>
            </div>
            <button class="btn" data-i18n-title="btn.clock" id="clockButton" title="Toggle Live Clock (K)">
                <div class="analog-clock">
                    <svg viewbox="0 0 100 100">
                        <circle class="clock-face" cx="50" cy="50" r="48"></circle>
                        <line class="hour-hand" x1="50" x2="50" y1="50" y2="25"></line>
                        <line class="minute-hand" x1="50" x2="50" y1="50" y2="15"></line>
                        <line class="second-hand" x1="50" x2="50" y1="50" y2="10"></line>
                        <circle class="hand-cap" cx="50" cy="50" r="3"></circle>
                    </svg>
                </div>
                <i class="fas fa-clock static-icon"></i>
                <span class="hotkey-label">K</span>
            </button>

            <div id="help-tools-container">
                <button class="btn" data-i18n-title="btn.help" id="helpButton" title="Help & Resources (?)">
                    <i class="fas fa-question-circle"></i><span class="hotkey-label">?</span>
                </button>
                <div id="help-bar">
                    <button class="btn" data-i18n-title="btn.tour" id="tourButton" title="Start Guided Tour">
                        <i class="fas fa-route"></i>
                    </button>
                    <button class="btn" data-i18n-title="btn.demo" id="demoButton" title="Show Demo Video">
                        <i class="fas fa-video"></i>
                    </button>
                    <button class="btn" data-i18n-title="btn.info" id="infoButton" title="Show Information">
                        <i class="fas fa-info-circle"></i>
                    </button>
                </div>
            </div>

            <button class="btn" data-i18n-title="btn.share" id="shareButton" title="Share with a Friend (J)">
                <i class="fas fa-share-alt"></i><span class="hotkey-label">J</span>
            </button>
            <button class="btn" data-i18n-title="btn.feedback" id="feedbackButton" title="Provide Feedback (F)">
                <i class="fas fa-comment-dots"></i><span class="hotkey-label">F</span>
            </button>
            <a class="btn" data-i18n="btn.tablet" data-i18n-title="btn.tablet.title" href="mobile.html" id="tabletLinkButton" target="_blank" title="Switch to Tablet Edition">
              <i class="fas fa-tablet-alt"></i>
            </a>
            <div class="theme-switch-wrapper btn" id="theme-switch-container">
                <label class="theme-switch" for="theme-toggle" title="Toggle Light/Dark Mode">
                    <input type="checkbox" id="theme-toggle">
                    <span class="slider round"></span>
                </label>
            </div>
        </div>
        <input id="colorPicker" style="display:none;" type="color"/>
    </div>
    <audio id="bellSound" preload="auto" src="bell.mp3"></audio>
    <audio id="shhSound" preload="auto"src="shh.mp3"></audio>
    <div id="digital-clock-bar"></div>
    <div id="date-display"></div>
    <footer>
        <p>© 2025 Teacher Toybox Ltd. All Rights Reserved.</p>
    </footer>

    <div id="feedback-backdrop" class="hidden"></div>
    <div id="feedback-panel">
        <button id="close-feedback-btn" title="Close">&times;</button>
        <h3 data-i18n="panel.feedback.title">Provide Feedback</h3>
        <p>We'd love to hear your thoughts!</p>
        <fieldset class="form-group">
            <legend>How would you rate your experience?</legend>
            <div id="feedback-rating" class="star-rating">
                <i class="fas fa-star" data-value="1"></i>
                <i class="fas fa-star" data-value="2"></i>
                <i class="fas fa-star" data-value="3"></i>
                <i class="fas fa-star" data-value="4"></i>
                <i class="fas fa-star" data-value="5"></i>
            </div>
        </fieldset>
        <div class="form-group">
            <label for="feedback-comment">Comments</label>
            <textarea id="feedback-comment" rows="5" placeholder="Tell us what you liked or what could be improved..."></textarea>
        </div>
        <button id="submit-feedback-btn" class="submit-btn">Submit</button>
    </div>
    <div id="upgrade-backdrop" class="hidden"></div>
    <div id="upgrade-panel">
        <button id="close-upgrade-btn" title="Close">&times;</button>
        <div class="upgrade-panel-content">
            <h3 data-i18n="panel.upgrade.title"><i class="fas fa-crown"></i> Go Premium</h3>
            <p>Supercharge your classroom by unlocking every interactive tool in the Teacher Toybox!</p>
            
            <table class="premium-features-table">
                <tbody>
                    <tr>
                        <td><i class="fas fa-check-circle"></i></td>
                        <td><strong>Unlock All Tools</strong></td>
                        <td>Get immediate access to every premium tool.</td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-check-circle"></i></td>
                        <td><strong>Webcam &amp; Document Camera</strong></td>
                        <td>Use your webcam for live demonstrations.</td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-check-circle"></i></td>
                        <td><strong>Photo Carousel</strong></td>
                        <td>Create engaging visual stories and slideshows.</td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-check-circle"></i></td>
                        <td><strong>Gamify Lessons</strong></td>
                        <td>Use the Dice Roller and Counters to make learning fun.</td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-check-circle"></i></td>
                        <td><strong>Manage Time</strong></td>
                        <td>Effortlessly manage classroom time with timers and stopwatches.</td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-check-circle"></i></td>
                        <td><strong>Advanced Control</strong></td>
                        <td>Adjust opacity and layer your windows for the perfect setup.</td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-check-circle"></i></td>
                        <td><strong>Future Tools</strong></td>
                        <td>Automatically get every new premium tool we release.</td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-check-circle"></i></td>
                        <td><strong>Support Development</strong></td>
                        <td>Help keep the core platform free for all teachers.</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="upgrade-button-container">
            <button id="panel-upgrade-btn" class="submit-btn">
                <div class="price-big">$2 per month</div>
                <div class="price-small">$24 billed annually</div>
            </button>
        </div>
    </div>


    <script>
      (function () {
        const SUPPORTED = {
          en: "English", cs: "Čeština", uk: "Українська", zh: "中文（简体）", hi: "हिन्दी", es: "Español", fr: "Français", ar: "العربية", fa: "فارسی", pt: "Português", ru: "Русский"
        };
    
        window.I18N = {
          en: { 
              meta: { title: "Teacher Toybox | Free Interactive Digital Whiteboard for Classrooms", titleShort: "Teacher Toybox | Interactive Whiteboard", description: "Teacher Toybox is a free interactive digital whiteboard with timers, dice and more to make lessons engaging. No installation required.", keywords: "digital whiteboard, interactive whiteboard, teacher tools, classroom resources, free teacher tools, online timer, classroom activities, education" }, 
              site: { brand: "Teacher Toybox", subtitle: "A whiteboard built by teachers for teachers." }, 
              lang: { label: "Language" }, 
              btn: { tablet: "Tablet Edition", "tablet.title": "Switch to Tablet Edition", clock: "Toggle Live Clock (K)", add: "Add New Window (N)", layouts: "Toggle Layouts (L)", colour: "Website Colour (X)", color: "Select Accent Color (C)", magic: "Extract Color from Content (M)", themePalette: "Theme Palette (Z)", bell: "Ring Bell (B)", shh: "Shush Sound (S)", "shh.label": "Shh", management: "Classroom Management Tools (/)", help: "Help & Resources (?)", laser: "Toggle Laser Pointer (P)", tour: "Start Guided Tour", demo: "Show Demo Video", info: "Show Information", refresh: "Refresh Page (R)", share: "Share with a Friend (J)", feedback: "Provide Feedback (F)", coffee: "Buy Me a Coffee (Y)", upgrade: "Upgrade to Premium (U)" }, 
              layout: { 1: "Layout 1: Full Screen (1)", 2: "Layout 2: Split Vertical (2)", 3: "Layout 3: Main Left (3)", 4: "Layout 4: Main Right (4)", 5: "Layout 5: Four Quadrants (5)", 6: "Layout 6: Tall Right Column (6)", 7: "Layout 7: 1-2-2 Column (7)" },
              panel: { "upgrade.title": "Go Premium", "share.title": "Spread the Word!", "feedback.title": "Provide Feedback" }
          },
          cs: { 
              meta: { title: "Teacher Toybox | Zdarma interaktivní tabule pro učitele", titleShort: "Teacher Toybox | Interaktivní tabule", description: "Teacher Toybox je zdarma interaktivní digitální tabule s časovači, kostkami a dalšími nástroji. Není potřeba instalace.", keywords: "digitální tabule, interaktivní tabule, nástroje pro učitele, zdroje pro třídu, bezplatné nástroje pro učitele, online časovač, aktivity ve třídě, vzdělávání" }, 
              site: { subtitle: "Zdarma interaktivní digitální tabule" }, 
              lang: { label: "Jazyk" }, 
              btn: { tablet: "Tabletová verze", "tablet.title": "Přepnout na tabletovou verzi", clock: "Zobrazit/skryt živé hodiny (K)", add: "Přidat nové okno (N)", layouts: "Přepnout nástroje rozložení (L)", colour: "Barva webu (X)", color: "Zvolit zvýrazňovací barvu (C)", magic: "Extrahovat barvu z obsahu (M)", themePalette: "Paleta motivů (Z)", bell: "Zazvonit (B)", shh: "Zvuk Ticho (S)", "shh.label": "Pšš", management: "Nástroje pro správu třídy (/)", help: "Nápověda a zdroje (?)", laser: "Přepnout laserové ukazovátko (P)", tour: "Spustit prohlídku", demo: "Zobrazit ukázkové video", info: "Zobrazit informace", refresh: "Obnovit stránku (R)", share: "Sdílet s přítelem (J)", feedback: "Zpětná vazba (F)", coffee: "Pozvat na kávu (Y)", upgrade: "Přejít na Premium (U)" }, 
              layout: { 1: "Rozvržení 1: Celá obrazovka (1)", 2: "Rozvržení 2: Vertikální rozdělení (2)", 3: "Rozvržení 3: Vlevo hlavní (3)", 4: "Rozvržení 4: Vpravo hlavní (4)", 5: "Rozvržení 5: Čtyři kvadranty (5)", 6: "Rozvržení 6: Vysoký pravý sloupec (6)", 7: "Rozvržení 7: 1-2-2 sloupce (7)" },
              panel: { "upgrade.title": "Přejít na Premium", "share.title": "Šířit dál!", "feedback.title": "Poskytnout zpětnou vazbu" }
          },
          // ... (Translations for other languages would go here)
        };
    
        window.t = function(dict, path) {
          try {
            return path.split('.').reduce((o, k) => (o && o[k] !== undefined) ? o[k] : undefined, dict);
          } catch { return undefined; }
        }
    
        function updateMeta(lang) {
          const dict = I18N[lang] || I18N.en;
          const title = t(dict, "meta.title"), titleShort = t(dict, "meta.titleShort") || title, desc = t(dict, "meta.description");
          if (title) document.title = title;
          if (desc) {
            const m = document.querySelector('meta[name="description"]'); if (m) m.setAttribute('content', desc);
            const ogd = document.querySelector('meta[property="og:description"]'); if (ogd) ogd.setAttribute('content', desc);
            const twd = document.querySelector('meta[name="twitter:description"]'); if (twd) twd.setAttribute('content', desc);
          }
          if (titleShort) {
            const ogt = document.querySelector('meta[property="og:title"]'); if (ogt) ogt.setAttribute('content', titleShort);
            const twt = document.querySelector('meta[name="twitter:title"]'); if (twt) twt.setAttribute('content', titleShort);
          }
        }

        function updateSchema(lang) {
            const dict = I18N[lang] || I18N.en;
            const schemaEl = document.getElementById('schema-ld');
            if (!schemaEl) return;

            const name = t(dict, "meta.titleShort");
            const description = t(dict, "meta.description");
            const keywords = t(dict, "meta.keywords");

            try {
                const schema = JSON.parse(schemaEl.textContent);
                if (name) schema.name = name;
                if (description) schema.description = description;
                if (keywords) schema.keywords = keywords;
                schemaEl.textContent = JSON.stringify(schema, null, 2);
            } catch (e) {
                console.error("Failed to update JSON-LD schema", e);
            }
        }
    
        function applyLang(lang) {
          const dict = I18N[lang] || I18N.en;
          localStorage.setItem('ttx_lang', lang);
          document.documentElement.lang = lang;
    
          document.querySelectorAll('[data-i18n]').forEach(el => {
            const val = t(dict, el.dataset.i18n) || t(I18N.en, el.dataset.i18n);
            if (typeof val === 'string') el.textContent = val;
          });
    
          document.querySelectorAll('[data-i18n-title]').forEach(el => {
            const key = el.dataset.i18nTitle;
            const val = t(dict, key) || t(I18N.en, key);
            if (typeof val === 'string') el.setAttribute('title', val);
          });
    
          const shh = document.getElementById('shhButton');
          if (shh) {
            const label = t(dict, 'btn.shh.label') || 'Shh';
            const hk = shh.querySelector('.hotkey-label');
            shh.innerHTML = label + (hk ? hk.outerHTML : '');
          }
    
          const tab = document.getElementById('tabletLinkButton');
          if (tab) {
            const l = t(dict, 'btn.tablet') || 'Tablet Edition';
            tab.firstChild && tab.firstChild.nodeType === Node.TEXT_NODE
              ? (tab.firstChild.nodeValue = l + ' ')
              : (tab.textContent = l);
          }
    
          const langLabel = document.querySelector('label[for="langSelect"][data-i18n="lang.label"]');
          if (langLabel) {
            const s = t(dict, 'lang.label') || 'Language';
            langLabel.textContent = s;
          }
    
          updateMeta(lang);
          updateSchema(lang);
          
          if (global.TT && typeof global.TT.updateDateDisplay === 'function') {
              global.TT.updateDateDisplay(lang);
          }
    
          const infoLangSel = document.querySelector('.info-language-selector');
          if (infoLangSel) {
            infoLangSel.value = lang;
            infoLangSel.dispatchEvent(new Event('change', { bubbles: true }));
          }
        }
    
        async function detectLanguage() {
          const supported = Object.keys(SUPPORTED);
          const regionMap = {
            'CZ': 'cs', 'UA': 'uk', 'CN': 'zh', 'HK':'zh', 'MO':'zh', 'TW':'zh', 'SG':'zh', 'MY':'zh',
            'IN': 'hi', 'ES': 'es', 'MX':'es', 'AR':'es', 'CL':'es', 'CO':'es', 'PE':'es', 'VE':'es', 'UY':'es', 'EC':'es', 'BO':'es', 'PY':'es', 'PA':'es', 'CR':'es', 'NI':'es', 'SV':'es', 'GT':'es', 'HN':'es', 'DO':'es', 'PR':'es',
            'FR': 'fr', 'BE':'fr', 'CH':'fr', 'CA':'fr', 'LU':'fr', 'AE': 'ar', 'SA':'ar', 'EG':'ar', 'MA':'ar', 'DZ':'ar', 'TN':'ar', 'QA':'ar', 'KW':'ar', 'OM':'ar', 'BH':'ar', 'IQ':'ar', 'JO':'ar', 'LB':'ar', 'LY':'ar', 'SD':'ar', 'YE':'ar',
            'IR': 'fa', 'PT': 'pt', 'BR':'pt', 'RU': 'ru', 'BY':'ru', 'KZ':'ru', 'KG':'ru',
            'US':'en', 'GB':'en', 'AU':'en', 'NZ':'en', 'IE':'en', 'ZA':'en', 'PH':'en', 'PK':'en', 'NG':'en', 'KE':'en'
          };
    
          try {
            const response = await fetch('https://ipapi.co/json/');
            if (!response.ok) throw new Error('IP API request failed');
            const data = await response.json();
            const country = data.country_code;
            if (country && regionMap[country]) {
              const lang = regionMap[country];
              if (supported.includes(lang)) {
                return lang;
              }
            }
          } catch (error) {
            console.warn('IP-based language detection failed, falling back to browser language.', error);
          }
          
          const nav = (navigator.language || 'en').split('-');
          const base = (nav[0] || 'en').toLowerCase();
          if (supported.includes(base)) return base;
    
          return 'en';
        }
    
        async function initPicker() {
          const sel = document.getElementById('langSelect');
          if (!sel) return;
          
          let userInteracted = false;
          
          sel.innerHTML = '';
          Object.entries(SUPPORTED).forEach(([code, name]) => {
            const opt = document.createElement('option');
            opt.value = code; opt.textContent = name;
            sel.appendChild(opt);
          });
    
          sel.addEventListener('change', (event) => {
            event.preventDefault(); // Prevent any default browser action
            event.stopPropagation(); // Stop the event from bubbling up to other listeners
            userInteracted = true;
            applyLang(sel.value);
          });
          
          const storedLang = localStorage.getItem('ttx_lang');
          let finalLang;
    
          if (storedLang && SUPPORTED[storedLang]) {
              finalLang = storedLang;
          } else {
              finalLang = await detectLanguage();
              if (userInteracted) return;
          }
          
          sel.value = finalLang;
          applyLang(finalLang); 
        }
    
        document.addEventListener('click', (e) => {
          if (e.target.id === 'infoButton') {
            const sel = document.getElementById('langSelect');
            const chosen = (sel ? sel.value : 'en');
            setTimeout(() => {
              const infoSel = document.querySelector('.info-language-selector');
              if (infoSel) {
                infoSel.value = chosen;
                infoSel.dispatchEvent(new Event('change', { bubbles: true }));
              }
            }, 50);
          }
        });
    
        document.addEventListener('DOMContentLoaded', initPicker);
      })();
      </script>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const authButton = document.getElementById('authButton');

        if (authButton) {
          authButton.addEventListener('click', async (e) => {
            e.preventDefault();
            
            if (typeof auth0Client !== 'undefined' && auth0Client) {
              const isAuthenticated = await auth0Client.isAuthenticated();
              if (isAuthenticated) {
                logout(); // If logged in, log out
              } else {
                login(); // If not logged in, log in
              }
            }
          });
        }
      });
    </script>
</body>
</html>